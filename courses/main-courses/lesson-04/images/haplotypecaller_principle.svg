<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: 'Source Han Sans CN', sans-serif; font-size: 18px; font-weight: bold; fill: #1e3a8a; }
      .subtitle { font-family: 'Source Han Sans CN', sans-serif; font-size: 14px; font-weight: bold; fill: #374151; }
      .text { font-family: 'Source Han Sans CN', sans-serif; font-size: 12px; fill: #4b5563; }
      .step-text { font-family: 'Source Han Sans CN', sans-serif; font-size: 11px; fill: white; font-weight: bold; }
      .dna { font-family: 'Courier New', monospace; font-size: 10px; font-weight: bold; }
      .ref { fill: #059669; }
      .alt { fill: #dc2626; }
      .haplotype { fill: #3b82f6; }
    </style>
  </defs>
  
  <!-- 标题 -->
  <text x="400" y="30" text-anchor="middle" class="title">HaplotypeCaller工作原理</text>
  
  <!-- 步骤1: 识别活跃区域 -->
  <g transform="translate(50, 60)">
    <text x="0" y="0" class="subtitle">步骤1: 识别活跃区域 (Active Region)</text>
    
    <!-- 参考基因组 -->
    <text x="0" y="25" class="text">参考基因组:</text>
    <rect x="0" y="35" width="500" height="15" fill="#e5e7eb" stroke="#9ca3af"/>
    <text x="250" y="46" text-anchor="middle" class="text" font-size="10">染色体区域</text>
    
    <!-- 比对reads -->
    <text x="0" y="70" class="text">比对reads:</text>
    <rect x="50" y="80" width="80" height="8" fill="#3b82f6" stroke="#1d4ed8"/>
    <rect x="80" y="90" width="80" height="8" fill="#3b82f6" stroke="#1d4ed8"/>
    <rect x="110" y="100" width="80" height="8" fill="#3b82f6" stroke="#1d4ed8"/>
    <rect x="140" y="110" width="80" height="8" fill="#3b82f6" stroke="#1d4ed8"/>
    
    <!-- 活跃区域标记 -->
    <rect x="120" y="130" width="100" height="20" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <text x="170" y="143" text-anchor="middle" class="text" font-weight="bold">活跃区域</text>
    
    <text x="0" y="170" class="text">标准: 与参考序列差异 &gt; 阈值的区域</text>
  </g>
  
  <!-- 步骤2: 局部重新组装 -->
  <g transform="translate(50, 250)">
    <text x="0" y="0" class="subtitle">步骤2: 局部序列重新组装</text>
    
    <!-- 提取reads -->
    <text x="0" y="25" class="text">提取活跃区域的所有reads:</text>
    <text x="0" y="45" class="dna">Read1: ATCGATCG&lt;tspan class=&quot;alt&quot;&gt;A&lt;/tspan&gt;TCGATCG</text>
    <text x="0" y="60" class="dna">Read2: TCGATCG&lt;tspan class=&quot;alt&quot;&gt;A&lt;/tspan&gt;TCGATCGA</text>
    <text x="0" y="75" class="dna">Read3: CGATCG&lt;tspan class=&quot;alt&quot;&gt;A&lt;/tspan&gt;TCGATCGAT</text>
    <text x="0" y="90" class="dna">Read4: GATCG&lt;tspan class=&quot;alt&quot;&gt;A&lt;/tspan&gt;TCGATCGATC</text>
    
    <!-- 箭头 -->
    <path d="M 250 60 L 300 60" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="275" y="55" text-anchor="middle" class="text">组装</text>
    
    <!-- 重新组装结果 -->
    <text x="320" y="25" class="text">重新组装的序列:</text>
    <rect x="320" y="35" width="200" height="60" fill="#f0fdf4" stroke="#22c55e" rx="5"/>
    <text x="330" y="50" class="dna haplotype">单倍型1: ATCGATCGATCGATCG</text>
    <text x="330" y="65" class="dna alt">单倍型2: ATCGATCG&lt;tspan class=&quot;alt&quot;&gt;A&lt;/tspan&gt;TCGATCG</text>
    <text x="330" y="80" class="text">候选变异: 位置9 插入A</text>
  </g>
  
  <!-- 步骤3: 单倍型比对 -->
  <g transform="translate(50, 380)">
    <text x="0" y="0" class="subtitle">步骤3: 单倍型比对和评分</text>
    
    <!-- 单倍型1比对 -->
    <text x="0" y="25" class="text">单倍型1 (参考型):</text>
    <text x="0" y="45" class="dna ref">ATCGATCGATCGATCG</text>
    <text x="200" y="45" class="text">支持reads: 15个</text>
    <text x="300" y="45" class="text">似然值: -45.2</text>
    
    <!-- 单倍型2比对 -->
    <text x="0" y="70" class="text">单倍型2 (变异型):</text>
    <text x="0" y="90" class="dna alt">ATCGATCG&lt;tspan class=&quot;alt&quot;&gt;A&lt;/tspan&gt;TCGATCG</text>
    <text x="200" y="90" class="text">支持reads: 12个</text>
    <text x="300" y="90" class="text">似然值: -38.7</text>
    
    <!-- 质量评估 -->
    <rect x="400" y="25" width="180" height="80" fill="#fef3c7" stroke="#f59e0b" rx="5"/>
    <text x="410" y="40" class="text" font-weight="bold">质量评估:</text>
    <text x="410" y="55" class="text">• 比对质量</text>
    <text x="410" y="70" class="text">• 碱基质量</text>
    <text x="410" y="85" class="text">• 支持reads数</text>
    <text x="410" y="100" class="text">• 链偏倚检测</text>
  </g>
  
  <!-- 步骤4: 变异调用 -->
  <g transform="translate(50, 500)">
    <text x="0" y="0" class="subtitle">步骤4: 变异调用和基因型确定</text>
    
    <!-- 统计检验 -->
    <rect x="0" y="20" width="200" height="60" fill="#f0f9ff" stroke="#3b82f6" rx="5"/>
    <text x="10" y="35" class="text" font-weight="bold">统计检验:</text>
    <text x="10" y="50" class="text">H₀: 无变异 (单倍型1)</text>
    <text x="10" y="65" class="text">H₁: 有变异 (单倍型2)</text>
    <text x="10" y="80" class="text">p值 &lt; 0.05 → 调用变异</text>
    
    <!-- 基因型确定 -->
    <rect x="220" y="20" width="200" height="60" fill="#f0fdf4" stroke="#22c55e" rx="5"/>
    <text x="230" y="35" class="text" font-weight="bold">基因型确定:</text>
    <text x="230" y="50" class="text">0/0: 纯合子参考型</text>
    <text x="230" y="65" class="text">0/1: 杂合子</text>
    <text x="230" y="80" class="text">1/1: 纯合子变异型</text>
    
    <!-- 输出结果 -->
    <rect x="440" y="20" width="200" height="60" fill="#fef2f2" stroke="#dc2626" rx="5"/>
    <text x="450" y="35" class="text" font-weight="bold">VCF输出:</text>
    <text x="450" y="50" class="dna" font-size="9">chr1 1000 . G GA 99.9</text>
    <text x="450" y="65" class="text">PASS DP=27 GT:AD:GQ</text>
    <text x="450" y="80" class="text">0/1:15,12:99</text>
  </g>
  
  <!-- 优势对比 -->
  <g transform="translate(450, 60)">
    <text x="0" y="0" class="subtitle">HaplotypeCaller优势</text>
    
    <rect x="0" y="15" width="300" height="160" fill="#f9fafb" stroke="#e5e7eb" rx="5"/>
    
    <text x="10" y="35" class="text" font-weight="bold">vs 传统方法:</text>
    
    <text x="10" y="55" class="text">✓ 同时检测SNP和InDel</text>
    <text x="10" y="70" class="text">✓ 减少比对偏倚</text>
    <text x="10" y="85" class="text">✓ 提高InDel检测精度</text>
    <text x="10" y="100" class="text">✓ 基于单倍型的联合分析</text>
    <text x="10" y="115" class="text">✓ 更准确的基因型确定</text>
    
    <text x="10" y="140" class="text" font-weight="bold">适用场景:</text>
    <text x="10" y="155" class="text">• 种系变异检测</text>
    <text x="10" y="170" class="text">• 高质量参考基因组</text>
  </g>
  
  <!-- 算法流程图 -->
  <g transform="translate(450, 250)">
    <text x="0" y="0" class="subtitle">算法流程总结</text>
    
    <!-- 流程框 -->
    <rect x="0" y="20" width="80" height="30" rx="5" fill="#3b82f6" stroke="#1d4ed8"/>
    <text x="40" y="38" text-anchor="middle" class="step-text" font-size="10">活跃区域</text>
    
    <path d="M 40 50 L 40 70" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
    
    <rect x="0" y="75" width="80" height="30" rx="5" fill="#059669" stroke="#047857"/>
    <text x="40" y="93" text-anchor="middle" class="step-text" font-size="10">局部组装</text>
    
    <path d="M 40 105 L 40 125" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
    
    <rect x="0" y="130" width="80" height="30" rx="5" fill="#dc2626" stroke="#b91c1c"/>
    <text x="40" y="148" text-anchor="middle" class="step-text" font-size="10">单倍型比对</text>
    
    <path d="M 40 160 L 40 180" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
    
    <rect x="0" y="185" width="80" height="30" rx="5" fill="#f59e0b" stroke="#d97706"/>
    <text x="40" y="203" text-anchor="middle" class="step-text" font-size="10">变异调用</text>
    
    <!-- 参数设置 -->
    <text x="100" y="35" class="text">参数: --min-base-quality-score</text>
    <text x="100" y="90" class="text">参数: --kmer-size</text>
    <text x="100" y="145" class="text">参数: --min-mapping-quality</text>
    <text x="100" y="200" class="text">参数: --standard-min-confidence-threshold</text>
  </g>
  
  <!-- 箭头标记定义 -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
  </defs>
</svg>